<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.starcoffee.repository.mybatis.mapper.OrderMapper">

    <resultMap id="orderInfo" type="com.project.starcoffee.domain.order.Order">
        <result property="orderId" column="order_id" javaType="java.util.UUID"/>
        <result property="memberId" column="member_id" javaType="java.util.UUID"/>
        <result property="itemId" column="item_id"/>
        <result property="storeId" column="store_id"/>
        <result property="status" column="status"/>
        <result property="itemCount" column="item_count"/>
        <result property="finalPrice" column="final_price"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

<!--    <resultMap id="orderRequest" type="com.project.starcoffee.controller.request.order.OrderRequest">-->
<!--        <result property="storeId" column="store_id"/>-->
<!--        <result property="itemCount" column="item_count"/>-->
<!--        <result property="finalPrice" column="final_price"/>-->

<!--        <collection property="items" ofType="com.project.starcoffee.dto.ItemDTO">-->
<!--            <id property="itemId" column="item_id"/>-->
<!--            <result property="itemName" column="item_name"/>-->
<!--            <result property="itemPrice" column="item_price"/>-->
<!--            <result property="itemType" column="item_type"/>-->
<!--            <result property="itemSize" column="item_size"/>-->
<!--            <result property="itemCup" column="item_cup"/>-->
<!--        </collection>-->
<!--    </resultMap>-->

    <insert id="saveOrder" parameterType="com.project.starcoffee.controller.request.order.OrderRequest">
        INSERT INTO ORDERS (member_id, item_id, store_id, item_count, final_price)
        VALUES (uuid_to_bin(#{memberId},1),
        <foreach collection="items" item="item" open="(" close=")" separator="," >
            #{item.itemId}
        </foreach>,
            #{storeId}, #{itemCount}, #{finalPrice})
    </insert>

    <select id="getOrderStatus" parameterType="java.util.UUID">
        SELECT status
        FROM ORDERS
        WHERE order_id = uuid_to_bin(#{orderId},1)
    </select>


</mapper>